<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        .hidden{
            display: none;
        }
    </style>
</head>
<body>
    <select name="selectCurso" id="selectCurso">
        <option selected value="">--selecione um curso--</option>
        <option value="medicina">medicina</option>
        <option value="veterinária">veterinária</option>
        <option value="engenharia">engenharia</option>
    </select>
    <select name="selectUni" id="selectUni">
        <option selected value="">--selecione uma universidade--</option>
        <option value="ufsm">ufsm</option>
        <option value="unifra">unifra</option>
        <option value="unisc">unisc</option>
        <option value="ucs">ucs</option>
        <option value="ufrgs">ufrgs</option>
        <option value="ufpel">ufpel</option>
        <option value="unipampa">unipampa</option>
    </select>
    <svg xmlns="http://www.w3.org/2000/svg" width="295" height="299" viewBox="0 0 295 299" fill="none">
        <g id="Frame 10">
        <g id="hexagono" clip-path="url(#clip0_10_4326)">
        <path id="Vector" d="M119.667 264.101V268.675L123.643 270.96L127.619 268.675V264.101L123.643 261.814L119.667 264.101Z" fill="#34106A" stroke="#5D4088" stroke-miterlimit="10"/>
        <path id="Vector_2" d="M127.619 264.101V268.675L131.597 270.96L135.573 268.675V264.101L131.597 261.814L127.619 264.101Z" fill="#34106A" stroke="#5D4088" stroke-miterlimit="10"/>
        <path id="Vector_3" d="M135.573 264.101V268.675L139.548 270.96L143.524 268.675V264.101L139.548 261.814L135.573 264.101Z" fill="#34106A" stroke="#5D4088" stroke-miterlimit="10"/>
        <path id="Vector_4" d="M143.524 264.101V268.675L147.5 270.96L151.476 268.675V264.101L147.5 261.814L143.524 264.101Z" fill="#34106A" stroke="#5D4088" stroke-miterlimit="10"/>
        <path id="Vector_5" d="M151.476 264.101V268.675L155.454 270.96L159.43 268.675V264.101L155.454 261.814L151.476 264.101Z" fill="#34106A" stroke="#5D4088" stroke-miterlimit="10"/>
        <path id="Vector_6" d="M159.43 264.101V268.675L163.406 270.96L167.382 268.675V264.101L163.406 261.814L159.43 264.101Z" fill="#34106A" stroke="#5D4088" stroke-miterlimit="10"/>
        <path id="Vector_7" d="M167.381 264.101V268.675L171.357 270.96L175.333 268.675V264.101L171.357 261.814L167.381 264.101Z" fill="#34106A" stroke="#5D4088" stroke-miterlimit="10"/>
        <path id="Vector_8" d="M131.597 271V275.572L135.573 277.859L139.548 275.572V271L135.573 268.713L131.597 271Z" fill="#34106A" stroke="#5D4088" stroke-miterlimit="10"/>
        <path id="Vector_9" d="M139.548 271V275.572L143.524 277.859L147.5 275.572V271L143.524 268.713L139.548 271Z" fill="#34106A" stroke="#5D4088" stroke-miterlimit="10"/>
        <path id="Vector_10" d="M147.5 271V275.572L151.476 277.859L155.454 275.572V271L151.476 268.713L147.5 271Z" fill="#34106A" stroke="#5D4088" stroke-miterlimit="10"/>
        <path id="Vector_11" d="M155.454 271V275.572L159.43 277.859L163.406 275.572V271L159.43 268.713L155.454 271Z" fill="#34106A" stroke="#5D4088" stroke-miterlimit="10"/>
        <path id="Vector_12" d="M143.524 277.799V282.37L147.5 284.657L151.476 282.37V277.799L147.5 275.511L143.524 277.799Z" fill="#34106A" stroke="#5D4088" stroke-miterlimit="10"/>
        <path id="Vector_13" d="M151.476 277.799V282.37L155.454 284.657L159.43 282.37V277.799L155.454 275.511L151.476 277.799Z" fill="#34106A" stroke="#5D4088" stroke-miterlimit="10"/>
        <path id="Vector_14" d="M155.454 284.647V289.219L159.43 291.506L163.406 289.219V284.647L159.43 282.36L155.454 284.647Z" fill="#34106A" stroke="#5D4088" stroke-miterlimit="10"/>
        <path id="Vector_15" d="M159.43 277.799V282.37L163.406 284.657L167.382 282.37V277.799L163.406 275.511L159.43 277.799Z" fill="#34106A" stroke="#5D4088" stroke-miterlimit="10"/>
        <path id="Vector_16" d="M163.406 271V275.572L167.381 277.859L171.357 275.572V271L167.381 268.713L163.406 271Z" fill="#34106A" stroke="#5D4088" stroke-miterlimit="10"/>
        <path id="Vector_17" d="M167.381 277.799V282.37L171.357 284.657L175.333 282.37V277.799L171.357 275.511L167.381 277.799Z" fill="#34106A" stroke="#5D4088" stroke-miterlimit="10"/>
        <path id="Vector_18" d="M171.357 271V275.572L175.333 277.859L179.311 275.572V271L175.333 268.713L171.357 271Z" fill="#34106A" stroke="#5D4088" stroke-miterlimit="10"/>
        <path id="Vector_19" d="M175.333 264.101V268.675L179.311 270.96L183.287 268.675V264.101L179.311 261.814L175.333 264.101Z" fill="#34106A" stroke="#5D4088" stroke-miterlimit="10"/>
        <path id="Vector_20" d="M179.311 257.252V261.827L183.287 264.111L187.263 261.827V257.252L183.287 254.965L179.311 257.252Z" fill="#34106A" stroke="#5D4088" stroke-miterlimit="10"/>
        <path id="Vector_21" d="M171.357 257.252V261.827L175.333 264.111L179.311 261.827V257.252L175.333 254.965L171.357 257.252Z" fill="#34106A" stroke="#5D4088" stroke-miterlimit="10"/>
        <path id="Vector_22" d="M151.476 291.506V296.08L155.454 298.367L159.43 296.08V291.506L155.454 289.219L151.476 291.506Z" fill="#34106A" stroke="#5D4088" stroke-miterlimit="10"/>
        <path id="Vector_23" d="M143.524 291.506V296.08L147.5 298.367L151.476 296.08V291.506L147.5 289.219L143.524 291.506Z" fill="#34106A" stroke="#5D4088" stroke-miterlimit="10"/>
        <path id="Vector_24" d="M147.5 284.647V289.219L151.476 291.506L155.454 289.219V284.647L151.476 282.36L147.5 284.647Z" fill="#34106A" stroke="#5D4088" stroke-miterlimit="10"/>
        <path id="Vector_25" d="M123.643 257.252V261.827L127.619 264.111L131.597 261.827V257.252L127.619 254.965L123.643 257.252Z" fill="#34106A" stroke="#5D4088" stroke-miterlimit="10"/>
        <path id="Vector_26" d="M127.619 250.404V254.978L131.597 257.265L135.573 254.978V250.404L131.597 248.117L127.619 250.404Z" fill="#34106A" stroke="#5D4088" stroke-miterlimit="10"/>
        <path id="Vector_27" d="M135.573 250.404V254.978L139.548 257.265L143.524 254.978V250.404L139.548 248.117L135.573 250.404Z" fill="#34106A" stroke="#5D4088" stroke-miterlimit="10"/>
        <path id="Vector_28" d="M131.597 257.252V261.827L135.573 264.111L139.548 261.827V257.252L135.573 254.965L131.597 257.252Z" fill="#34106A" stroke="#5D4088" stroke-miterlimit="10"/>
        <path id="Vector_29" d="M139.548 257.252V261.827L143.524 264.111L147.5 261.827V257.252L143.524 254.965L139.548 257.252Z" fill="#34106A" stroke="#5D4088" stroke-miterlimit="10"/>
        <path id="Vector_30" d="M147.5 257.252V261.827L151.476 264.111L155.454 261.827V257.252L151.476 254.965L147.5 257.252Z" fill="#34106A" stroke="#5D4088" stroke-miterlimit="10"/>
        <path id="Vector_31" d="M155.454 257.252V261.827L159.43 264.111L163.406 261.827V257.252L159.43 254.965L155.454 257.252Z" fill="#34106A" stroke="#5D4088" stroke-miterlimit="10"/>
        <path id="Vector_32" d="M163.406 257.252V261.827L167.381 264.111L171.357 261.827V257.252L167.381 254.965L163.406 257.252Z" fill="#34106A" stroke="#5D4088" stroke-miterlimit="10"/>
        <path id="Vector_33" d="M143.524 250.492V255.066L147.5 257.351L151.476 255.066V250.492L147.5 248.205L143.524 250.492Z" fill="#34106A" stroke="#5D4088" stroke-miterlimit="10"/>
        <path id="Vector_34" d="M151.476 250.492V255.066L155.454 257.351L159.43 255.066V250.492L155.454 248.205L151.476 250.492Z" fill="#34106A" stroke="#5D4088" stroke-miterlimit="10"/>
        <path id="Vector_35" d="M159.43 250.492V255.066L163.406 257.351L167.382 255.066V250.492L163.406 248.205L159.43 250.492Z" fill="#34106A" stroke="#5D4088" stroke-miterlimit="10"/>
        <path id="Vector_36" d="M139.548 243.605V248.18L143.524 250.464L147.5 248.18V243.605L143.524 241.318L139.548 243.605Z" fill="#34106A" stroke="#5D4088" stroke-miterlimit="10"/>
        <path id="Vector_37" d="M147.5 243.605V248.18L151.476 250.464L155.454 248.18V243.605L151.476 241.318L147.5 243.605Z" fill="#34106A" stroke="#5D4088" stroke-miterlimit="10"/>
        </g>
        </g>
        <defs>
        <filter id="filter0_d_10_4326" x="162.881" y="247.54" width="16.9516" height="18.3021" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
        <feFlood flood-opacity="0" result="BackgroundImageFix"/>
        <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
        <feOffset dy="4"/>
        <feGaussianBlur stdDeviation="2"/>
        <feComposite in2="hardAlpha" operator="out"/>
        <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>
        <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_10_4326"/>
        <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_10_4326" result="shape"/>
        </filter>
        <clipPath id="clip0_10_4326">
        <rect width="295" height="298" fill="white" transform="translate(0 0.804626)"/>
        </clipPath>
        </defs>
        </svg>

        <div id="popup" class="hidden" style="
                            width: 100px;
                            height: 65px;
                            background: #e7e7e7;
                            margin: auto;
                            border-radius: 10px;
                        ">
            fgdfghfgh
        </div>
</body>
</html>

<script>
    const unis = [
        {
            nome: "ufsm",
            cidade: "santa maria",
            lat: "-29.7247465",
            lng: "-53.8697193"
        },
        {
            nome: "unisc",
            cidade: "santa cruz",
            lat: "-29.703003",
            lng: "-52.436394"
        },
        {
            nome: "unifra",
            cidade: "santa maria",
            lat: "-29.7247465",
            lng: "-53.8697193"
        },
        {
            nome: "ufrgs",
            cidade: "poa",
            lat: "-30.0339679",
            lng: "-51.2216232"
        },
        {
            nome: "ucs",
            cidade: "caxias do sul",
            lat: "-29.1856908",
            lng: "-51.2908515"
        },
        {
            nome: "unipampa",
            cidade: "alegrete",
            lat: '-29.7890282',
            lng: '-55.7887141'
        },
        {
            nome: "ufpel",
            cidade: "pelotas",
            lat: "-31.781777",
            lng: "-52.325648"
        }
    ]
    const dados = {
        rs: {
            hexagonos: [
                {
                    id: 'Vector',
                    lat: '-29.951131',
                    lng: '-56.989695',
                },
                {
                    id: 'Vector_2',
                    lat: '-29.880848',
                    lng: '-55.827448'
                },
                {
                    id: 'Vector_3',
                    lat: '-29.779241',
                    lng: '-55.106675',
                },
                {
                    id: 'Vector_4',
                    lat: '-29.755778',
                    lng: '-54.575104',
                },
                {
                    id: 'Vector_5',
                    lat: '-29.708837',
                    lng: '-53.710176',
                },
                {
                    id: 'Vector_6',
                    lat: '-29.787061',
                    lng: '-52.683074',
                },
                {
                    id: 'Vector_7',
                    lat: '-29.841781',
                    lng: '-51.313605',
                },
                {
                    id: 'Vector_8',
                    lat: '-30.829323',
                    lng: '-55.809429',
                },
                {
                    id: 'Vector_9',
                    lat: '-30.713204',
                    lng: '-54.719259',
                },
                {
                    id: 'Vector_10',
                    lat: '-30.643465',
                    lng: '-53.656118',
                },
                {
                    id: 'Vector_11',
                    lat: '-30.612454',
                    lng: '-52.719113',
                },
                {
                    id: 'Vector_12',
                    lat: '-31.283982',
                    lng: '-54.116781',
                },
                {
                    id: 'Vector_13',
                    lat: '-31.331455',
                    lng: '-52.949940',
                },
                {
                    id: 'Vector_14',
                    lat: '-31.799851',
                    lng: '-52.355362',
                },
                {
                    id: 'Vector_15',
                    lat: '-31.198794',
                    lng: '-51.608607',
                },
                {
                    id: 'Vector_16',
                    lat: '-30.604179',
                    lng: '-51.722114',
                },
                {
                    id: 'Vector_17',
                    lat: '-30.686414',
                    lng: '-50.527306',
                },
                {
                    id: 'Vector_18',
                    lat: '-30.062782',
                    lng: '-50.228604',
                },
                {
                    id: 'Vector_19',
                    lat: '-29.779241',
                    lng: '-50.124329',
                },
                {
                    id: 'Vector_20',
                    lat: '-29.143834',
                    lng: '-49.845029',
                },
                {
                    id: 'Vector_21',
                    lat: '-28.852268',
                    lng: '-50.610851',
                },
                {
                    id: 'Vector_22',
                    lat: '-32.873164',
                    lng: '-52.540205',
                },
                {
                    id: 'Vector_23',
                    lat: '-32.582923',
                    lng: '-53.313675',
                },
                {
                    id: 'Vector_24',
                    lat: '-31.862367',
                    lng: '-53.111620',
                },
                {
                    id: 'Vector_25',
                    lat: '-29.274054',
                    lng: '-56.523551',
                },
                {
                    id: 'Vector_26',
                    lat: '-28.279491',
                    lng: '-55.625572',
                },
                {
                    id: 'Vector_27',
                    lat: '-28.315430',
                    lng: '-54.425545',
                },
                {
                    id: 'Vector_28',
                    lat: '-29.202820',
                    lng: '-55.445976',
                },
                {
                    id: 'Vector_29',
                    lat: '-29.045932',
                    lng: '-53.968392',
                },
                {
                    id: 'Vector_30',
                    lat: '-28.853060',
                    lng: '-53.429605',
                },
                {
                    id: 'Vector_31',
                    lat: '-28.702801',
                    lng: '-52.066310',
                },
                {
                    id: 'Vector_32',
                    lat: '-28.995192',
                    lng: '-51.209309',
                },
                {
                    id: 'Vector_33',
                    lat: '-27.930431',
                    lng: '-53.644918',
                },
                {
                    id: 'Vector_34',
                    lat: '-27.912887',
                    lng: '-52.546247',
                },
                {
                    id: 'Vector_35',
                    lat: '-27.866088',
                    lng: '-51.427719',
                },
                {
                    id: 'Vector_36',
                    lat: '-27.344100',
                    lng: '-53.995699',
                },
                {
                    id: 'Vector_37',
                    lat: '-27.208801',
                    lng: '-52.963212',
                }
            ]
        }
    }

    let hexagonosPintados = [];
    document.getElementById("selectUni").addEventListener("change",function(evento){
        hexagonosPintados = resetHexagonos(hexagonosPintados);

        document.getElementById("popup").innerText = "";
        document.getElementById("popup").classList.add("hidden")

        const universidade = unis.filter(u => u.nome === evento.target.value)[0]
        const vectorMenorDistancia = haversineDistance(universidade);

        hexagonosPintados.push(vectorMenorDistancia)
        document.getElementById(vectorMenorDistancia.id).setAttribute("fill","#00ff04")
        document.getElementById(vectorMenorDistancia.id).classList.add("verde")
    });

    document.getElementById("selectCurso").addEventListener("change",function(evento){
        hexagonosPintados = resetHexagonos(hexagonosPintados);

        document.getElementById("popup").innerText = "";
        document.getElementById("popup").classList.add("hidden")
        const hexagonosUniversidades = []

        //supondo que venha um array de universidades da api
        unis.forEach(universidade => {
            const vectorMenorDistancia = haversineDistance(universidade);
            hexagonosUniversidades.push(vectorMenorDistancia)
            hexagonosPintados.push(vectorMenorDistancia);
        })
        hexagonosUniversidades.forEach(h => {
            document.getElementById(h.id).setAttribute("fill","#00ff04")
            document.getElementById(h.id).classList.add("verde")
        })
    });

    //calcula distancia entre 2 coordenadas através da equação de haversine
    const haversineDistance = (universidade) => {
        var R = 6371; // Radius of the earth in km
        let menor;
        let vectorMenorDistancia = null;
        dados.rs.hexagonos.forEach((hexagono, i) => {
            var dLat = deg2rad(Number(hexagono.lat) - Number(universidade.lat));  // deg2rad below
            var dLon = deg2rad(Number(hexagono.lng) - Number(universidade.lng)); 
            var a = Math.sin(dLat/2) * Math.sin(dLat/2) + Math.cos(deg2rad(Number(universidade.lat))) * Math.cos(deg2rad(Number(hexagono.lat))) * Math.sin(dLon/2) * Math.sin(dLon/2); 
            var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
            var d = R * c; // Distance in km
            if(i==0){
                menor = d;
                vectorMenorDistancia = hexagono;
            }
            else if(d < menor){
                menor = d;
                vectorMenorDistancia = hexagono;
            }
        })
        function deg2rad(deg) {
            return deg * (Math.PI/180)
        }
        vectorMenorDistancia.universidade = universidade.nome;
        return vectorMenorDistancia;
    }

    //pega todos os elementos em que o id começa com "Vector"
    const hexagonos = document.querySelectorAll('[id^="Vector"]')
    for(let i=0; i<hexagonos.length; i++){
        hexagonos[i].addEventListener("click",function(e){
            if(e.target.classList.contains("verde")){
                const hexagono = dados.rs.hexagonos.filter(h => h.id === hexagonos[i].id)[0]
                document.getElementById("popup").innerText = hexagono.universidade
                document.getElementById("popup").classList.toggle('hidden')
            }
        })
    }

    //pinta de roxo novamente todos os hexagonos que estavam verdes
    function resetHexagonos(hexagonosPintados){
        hexagonosPintados.forEach(h => {
            document.getElementById(h.id).setAttribute("fill","#34106A")
            document.getElementById(h.id).classList.remove("verde")
        })
        return [];
    }
</script>
